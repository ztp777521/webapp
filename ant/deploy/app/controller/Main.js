Ext.define("eapp.controller.Main",{extend:"Ext.app.Controller",config:{refs:{mainview:"mainview",actionButton:"#actionButton"},control:{mainview:{back:"onBackButtonTap",initcomplete:"onInitComplete"}}},onBackButtonTap:function(c,d){var b=eapp.app.pageStack;var a=b.length;if(a>1){b.pop()}this.doBackChanges()},doBackChanges:function(){var c=this;var b=eapp.app.pageStack;console.log(b);var a=b.length;switch(b[a-1]){case"main":c.getMainview().getNavigationBar().hide();c.getActionButton().hide();break;case"communicationview":this.getActionButton().show();this.getActionButton().setText("删除");break;default:this.getActionButton().hide();break}console.log(eapp.app.pageStack)},onInitComplete:function(){var h=this.getParam("communicationid");if(h==null){return}var f=this.getMainview();var a=this.getActionButton();if(h==0){var c=Ext.create("eapp.view.Communication");c.init();f.getNavigationBar().show();f.push(c);eapp.app.pageStack.push("communication")}else{try{window.SQLite_query(function g(n){var j=Ext.create("eapp.store.Communication",{data:Ext.JSON.decode(n).data});for(var l=0;l<j.getCount();l++){var k=j.getAt(l);var m=k.get("message");m=decodeURIComponent(m);k.set("message",m);if(k.get("id")==h){var e=Ext.create("eapp.view.CommunicationView");e.setData(k);e.init();a.setText("删除");a.show();f.getNavigationBar().show();f.push(e);eapp.app.pageStack.push("communicationview")}}},function b(e){eapp.view.Dialogs.showAlert("错误","无法从数据库读取消息！")},"select * from tbcommunication where isdeleted = 0 order by id desc limit 20")}catch(d){eapp.view.Dialogs.showAlert("错误","从数据库读取消息失败！")}}},getParam:function(b){var a=window.location+"";if(a.indexOf("?")>-1){var d=a.split("?")[1];var f=d.split("&");for(var c=0;c<f.length;c++){var e=f[c];var g=e.split("=");if(g[0]==b){return g[1]}}}return null}});