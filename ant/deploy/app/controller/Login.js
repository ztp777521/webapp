Ext.define("eapp.controller.Login",{extend:"Ext.app.Controller",config:{refs:{mainview:"mainview",loginView:"loginView",registerView:"registerView",loginButton:{selector:"loginView formpanel button[name=loginButton]"},regButton:{selector:"loginView formpanel button[name=regButton]"},registerButton:{selector:"registerView formpanel button[name=registerButton]"},},control:{loginButton:{tap:"OnLoginButtonTap",},regButton:{tap:"OnRegButtonTap",},registerButton:{tap:"OnRegisterButtonTap"}}},OnRegisterButtonTap:function(){var h=this;var i=h.getRegisterView();if(i==null||i=="undefined"){i=Ext.create("eapp.view.Register")}var d=Ext.ComponentQuery.query("#loginnameid",i)[0].getValue();var a=Ext.ComponentQuery.query("#passwordid",i)[0].getValue();var c=Ext.ComponentQuery.query("#usernameid",i)[0].getValue();var g=Ext.ComponentQuery.query("#telid",i)[0].getValue();var f=Ext.ComponentQuery.query("#emailid",i)[0].getValue();var e=Ext.ComponentQuery.query("#numberid",i)[0].getValue();if(d==null||d=="undefined"||d.length<=0){eapp.view.Dialogs.showAlert("智慧潘家园","登录名不能为空");return}if(a==null||a=="undefined"||a.length<=0){eapp.view.Dialogs.showAlert("智慧潘家园","登录密码不能为空");return}if(c==null||c=="undefined"||c.length<=0){eapp.view.Dialogs.showAlert("智慧潘家园","用户名不能为空");return}if(g==null||g=="undefined"||g.length<=0){eapp.view.Dialogs.showAlert("智慧潘家园","手机号不能为空");return}if(f==null||f=="undefined"||f.length<=0){eapp.view.Dialogs.showAlert("智慧潘家园","邮箱不能为空");return}Ext.Viewport.setMasked({xtype:"loadmask",message:"请稍候..."});var b=Ext.create("eapp.business.ResidentuserService");b.register(d,a,c,g,f,e,{success:function(k){if(k!="false"){var j=h.getMainview().getNavigationBar().getBackButton();j.fireEvent("tap",j,null,null);eapp.view.Dialogs.showAlert("智慧潘家园","注册成功!~")}else{eapp.view.Dialogs.showAlert("智慧潘家园","注册失败!~")}Ext.Viewport.setMasked(false)},failure:function(j){console.log(j);Ext.Viewport.setMasked(false)}})},OnLoginButtonTap:function(){var d=this;var b=d.getLoginView();if(b==null||b=="undefined"){b=Ext.create("eapp.view.Login")}var e=Ext.ComponentQuery.query("#usernameLogin",b)[0].getValue();var a=Ext.ComponentQuery.query("#passwordLogin",b)[0].getValue();if(e==null||e=="undefined"||e.length<=0){eapp.view.Dialogs.showAlert("智慧潘家园","用户名不能为空");return}if(a==null||a=="undefined"||a.length<=0){eapp.view.Dialogs.showAlert("智慧潘家园","密码不能为空");return}Ext.Viewport.setMasked({xtype:"loadmask",message:"请稍候..."});var c=Ext.create("eapp.business.ResidentuserService");c.login(e,a,{success:function(g){console.log(g);eapp.util.GlobalData.setCurrentUser(Ext.JSON.encode(g));eapp.util.GlobalData.setUserName(e);eapp.util.GlobalData.setPassword(a);if(g!="null"){var f=d.getMainview().getNavigationBar().getBackButton();f.fireEvent("tap",f,null,null);eapp.view.Dialogs.showAlert("智慧潘家园","登录成功!~")}else{eapp.view.Dialogs.showAlert("智慧潘家园","登录失败!~")}Ext.Viewport.setMasked(false)},failure:function(f){console.log(f);Ext.Viewport.setMasked(false)}})},OnRegButtonTap:function(){var b=this;var a=b.getRegisterView();if(a==null||a=="undefined"){a=Ext.create("eapp.view.Register")}b.getMainview().push(a);eapp.app.pageStack.push("registerview")},});