Ext.define("eapp.controller.My",{extend:"Ext.app.Controller",config:{refs:{mainview:"mainview",myView:"myView",loginView:"loginView",setPersonalView:"setPersonalView",wanshanziliaoid:{selector:"myView formpanel fieldset labelEx[name=wanshanziliaoid]"},uppasswordid:{selector:"myView formpanel fieldset labelEx[name=uppasswordid]"},cllloginid:{selector:"myView formpanel fieldset labelEx[name=cllloginid]"},updateButton:{selector:"setPersonalView formpanel button[name=updateButton]"},},control:{wanshanziliaoid:{tap:"OnWanshanziliaoTap",},uppasswordid:{tap:"OnuppasswordTap",},cllloginid:{tap:"OnCllloginTap",},updateButton:{tap:"OnUpdateButtonTap",}}},OnUpdateButtonTap:function(){var j=this;var a=eapp.util.GlobalData.getCurrentUser();var g=j.getSetPersonalView();if(g==null||g=="undefined"){g=Ext.create("eapp.view.SetPersonal")}var c=a.get("userid");var e=Ext.ComponentQuery.query("#loginnameid",g)[0].getValue();var b=Ext.ComponentQuery.query("#usernameid",g)[0].getValue();var i=Ext.ComponentQuery.query("#telephonenumid",g)[0].getValue();var f=Ext.ComponentQuery.query("#emailid",g)[0].getValue();var d=Ext.ComponentQuery.query("#interestid",g)[0].getValue();Ext.Viewport.setMasked({xtype:"loadmask",message:"请稍候..."});var h=Ext.create("eapp.business.ResidentuserService");h.upuser(c,e,b,i,f,d,{success:function(l){if(l!="null"){eapp.util.GlobalData.setCurrentUser(Ext.JSON.encode(l));var k=j.getMainview().getNavigationBar().getBackButton();k.fireEvent("tap",k,null,null);eapp.view.Dialogs.showAlert("智慧潘家园","修改成功!~")}else{eapp.view.Dialogs.showAlert("智慧潘家园","修改失败!~")}Ext.Viewport.setMasked(false)},failure:function(k){console.log(k);Ext.Viewport.setMasked(false)}})},OnWanshanziliaoTap:function(){var d=this;var b=eapp.util.GlobalData.getCurrentUser();var c=d.getSetPersonalView();if(c==null||c=="undefined"){c=Ext.create("eapp.view.SetPersonal")}var b=eapp.util.GlobalData.getCurrentUser();Ext.ComponentQuery.query("#loginnameid",c)[0].setValue(b.get("loginname"));Ext.ComponentQuery.query("#usernameid",c)[0].setValue(b.get("realname"));Ext.ComponentQuery.query("#telephonenumid",c)[0].setValue(b.get("familyTelephonenum"));Ext.ComponentQuery.query("#emailid",c)[0].setValue(b.get("email"));Ext.ComponentQuery.query("#interestid",c)[0].setValue(b.get("telephonenum"));d.getMainview().push(c);var a=eapp.app.pageStack.length;if(eapp.app.pageStack[a-1]!="setpersonalview"){eapp.app.pageStack.push("setpersonalview")}},OnuppasswordTap:function(){eapp.view.Dialogs.showAlert("智慧潘家园","修改密码!~")},OnCllloginTap:function(){var a=this;eapp.view.Dialogs.showSearchComfirm("智慧潘家园","确认要注销么？",{yes:function(){eapp.util.GlobalData.setCurrentUser("");var c=a.getLoginView();if(c==null||c=="undefined"){c=Ext.create("eapp.view.Login")}c.setIsautoFlag(false);Ext.ComponentQuery.query("#usernameLogin",c)[0].setValue("");Ext.ComponentQuery.query("#passwordLogin",c)[0].setValue("");eapp.util.GlobalData.setUserName("");eapp.util.GlobalData.setPassword("");var b=a.getMainview().getNavigationBar().getBackButton();b.fireEvent("tap",b,null,null)},on:function(){return}})}});